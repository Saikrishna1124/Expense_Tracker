<h1>Welcome, {{ current_user.username }}!</h1>
<a href="{{ url_for('add_expense') }}">Add Expense</a> | 
<a href="{{ url_for('logout') }}">Logout</a> | 
<a href="{{ url_for('export_csv') }}">Download CSV</a>

<h2>Your Expenses (Currency: {{ currency }})</h2>

{% if budget_warning %}
    <h3 style="color: red;">⚠️ Warning! You've exceeded your budget of {{ current_user.monthly_budget }} {{ currency }}!</h3>
{% endif %}

<form method="POST">
    <label>Filter by Category:</label>
    <select name="category">
        <option value="">All</option>
        <option value="Food">Food</option>
        <option value="Transport">Transport</option>
        <option value="Shopping">Shopping</option>
        <option value="Health">Health</option>
    </select>
    
    <label>Filter by Date:</label>
    <input type="date" name="date">
    
    <button type="submit">Filter</button>
</form>

<ul>
    {% for expense in expenses %}
        <li>{{ expense.date.strftime('%Y-%m-%d') }} - {{ expense.category }}: {{ expense.amount }} {{ currency }}</li>
    {% else %}
        <li>No expenses found.</li>
    {% endfor %}
</ul>

<h2>Expense Overview</h2>
<canvas id="expenseChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var ctx = document.getElementById('expenseChart').getContext('2d');

    var expenseChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ categories.keys() | list | tojson }},
            datasets: [{
                label: 'Amount Spent',
                data: {{ categories.values() | list | tojson }},
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
